{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="main-container">
    <div class="content-card">
        <h2 class="section-title">Créer une annonce</h2>
        <form method="POST" enctype="multipart/form-data" class="form-container">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="title">Titre de l'annonce *</label>
                <input type="text" id="title" name="title" required placeholder="Ex: Compte FreeFire niveau 50 avec skins rares">
            </div>

            <div class="form-group">
                <label for="game">Type de jeu *</label>
                <select name="game" id="game" required>
                    <option value="">Sélectionnez un jeu</option>
                    <option value="FreeFire">FreeFire</option>
                    <option value="PUBG">PUBG Mobile</option>
                    <option value="COD">Call of Duty Mobile</option>
                    <option value="efootball">eFootball Mobile</option>
                    <option value="fc25">FC25 Mobile</option>
                    <option value="bloodstrike">Bloodstrike</option>
                    <option value="other">Autres</option>
                </select>
            </div>

            <div class="form-group" id="custom-game-group" style="display: none;">
                <label for="custom_game_name">Nom du jeu personnalisé *</label>
                <input type="text" id="custom_game_name" name="custom_game_name" placeholder="Ex: Roblox, Minecraft, etc.">
                <small class="form-help">Ce nom sera sauvegardé pour une future intégration dans la liste des jeux.</small>
            </div>

            <div class="form-group">
                <label for="coins">Nombre de pièces/coins *</label>
                <input type="text" id="coins" name="coins" required placeholder="Ex: 5000 UC, 2500 V-Bucks, 10000 pièces eFootball">
                <small class="form-help">Indiquez le nombre de monnaie principale du jeu (UC, V-Bucks, pièces, etc.)</small>
            </div>

            <div class="form-group">
                <label for="level">Niveau du compte *</label>
                <input type="text" id="level" name="level" required placeholder="Ex: 50, Diamant, Niveau 100, Master">
                <small class="form-help">Niveau, rang ou grade du compte</small>
            </div>

            <div class="form-group price-container">
                <label for="price">Prix *</label>
                <div class="price-input-group">
                    <input type="number" id="price" name="price" required min="0" step="0.01" placeholder="0.00">
                    <select name="currency" id="currency" required>
                        <option value="EUR">€ (EUR)</option>
                        <option value="USD">$ (USD)</option>
                        <option value="GBP">£ (GBP)</option>
                        <option value="JPY">¥ (JPY)</option>
                        <option value="CHF">CHF</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="caption">Description *</label>
                <textarea id="caption" name="caption" rows="4" required placeholder="Décrivez votre compte, ses caractéristiques, niveaux, skins, etc."></textarea>
            </div>

            <div class="form-group upload-container">
                <label for="banner">
                    <i class="fas fa-image"></i>
                    Bannière du produit * (Image principale)
                </label>
                <div class="banner-recommendations">
                    <h4><i class="fas fa-info-circle"></i> Dimensions recommandées</h4>
                    <p>Pour un affichage optimal, utilisez des images en format paysage :</p>
                    <ul>
                        <li><strong>1600x900 pixels</strong> (ratio 16:9) - Recommandé</li>
                        <li><strong>1920x1080 pixels</strong> (ratio 16:9) - Haute qualité</li>
                        <li><strong>1280x720 pixels</strong> (ratio 16:9) - Alternative</li>
                    </ul>
                    <p><small>Formats acceptés: JPG, PNG, GIF. Taille max: 5MB</small></p>
                </div>
                <div class="upload-zone">
                    <input type="file" id="banner" name="banner" accept="image/*" required>
                    <div class="upload-placeholder">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Glissez votre bannière ici ou cliquez pour sélectionner</p>
                    </div>
                </div>
                <div id="banner-preview" class="banner-preview-container"></div>
            </div>

            <div class="form-group upload-container">
                <label for="images">
                    <i class="fas fa-images"></i>
                    Images supplémentaires (maximum 5) *
                </label>
                <div class="upload-zone">
                    <input type="file" id="images" name="images[]" accept="image/*" multiple required>
                    <div class="upload-placeholder">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Glissez vos images ici ou cliquez pour sélectionner</p>
                        <small>Ces images seront affichées dans le carousel après la bannière. Formats: JPG, PNG, GIF. Taille max: 5MB par image</small>
                    </div>
                </div>
                <div id="image-preview" class="image-preview-container"></div>
            </div>

            <div class="form-group upload-container">
                <label for="video">
                    <i class="fas fa-video"></i>
                    Vidéo (optionnel)
                </label>
                <div class="upload-zone">
                    <input type="file" id="video" name="video" accept="video/*">
                    <div class="upload-placeholder">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Glissez votre vidéo ici ou cliquez pour sélectionner</p>
                        <small>Cette vidéo sera affichée dans le carousel. Formats: MP4, AVI, MOV. Taille max: 50MB</small>
                    </div>
                </div>
                <div id="video-preview" class="video-preview-container"></div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-submit">
                    <i class="fas fa-plus"></i>
                    Créer l'annonce
                </button>
                <a href="{% url 'index' %}" class="btn-cancel">
                    <i class="fas fa-times"></i>
                    Annuler
                </a>
            </div>
        </form>
    </div>
</div>

<style>
.main-container {
    min-height: 100vh;
    padding: 2rem;
    background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
}

.content-card {
    max-width: 800px;
    margin: 0 auto;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 20px;
    padding: 3rem;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.section-title {
    text-align: center;
    font-size: 2.5rem;
    margin-bottom: 3rem;
    font-family: 'RussoOne', sans-serif;
    color: var(--primary-color);
    text-shadow: 0 0 15px var(--primary-color);
}

.form-container {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.form-group label {
    color: white;
    font-weight: 600;
    font-size: 1.1rem;
}

.form-group input,
.form-group select,
.form-group textarea {
    padding: 1rem;
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.05);
    color: white;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 15px rgba(108, 92, 231, 0.3);
}

.form-group input::placeholder,
.form-group textarea::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

.price-input-group {
    display: flex;
    gap: 1rem;
}

.price-input-group input {
    flex: 2;
}

.price-input-group select {
    flex: 1;
}

.upload-container {
    border: 2px dashed rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    padding: 2rem;
    text-align: center;
    transition: all 0.3s ease;
}

.upload-container:hover {
    border-color: var(--primary-color);
    background: rgba(108, 92, 231, 0.05);
}

.upload-zone {
    position: relative;
}

.upload-zone input[type="file"] {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
}

.upload-placeholder {
    pointer-events: none;
}

.upload-placeholder i {
    font-size: 3rem;
    color: var(--primary-color);
    margin-bottom: 1rem;
}

.upload-placeholder p {
    color: white;
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
}

.upload-placeholder small {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.9rem;
}

.banner-preview-container {
    margin-top: 1rem;
    text-align: center;
}

.banner-preview {
    max-width: 300px;
    max-height: 200px;
    border-radius: 10px;
    border: 2px solid var(--primary-color);
    object-fit: cover;
}

.banner-recommendations {
    background: rgba(108, 92, 231, 0.1);
    border: 1px solid rgba(108, 92, 231, 0.3);
    border-radius: 10px;
    padding: 1rem;
    margin-bottom: 1rem;
}

.banner-recommendations h4 {
    color: var(--primary-color);
    margin-bottom: 0.5rem;
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.banner-recommendations p {
    color: #ccc;
    margin: 0.5rem 0;
    font-size: 0.9rem;
}

.banner-recommendations ul {
    color: #ccc;
    margin: 0.5rem 0;
    padding-left: 1.5rem;
}

.banner-recommendations li {
    margin-bottom: 0.3rem;
    font-size: 0.9rem;
}

.banner-recommendations small {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.8rem;
}

/* Les styles pour les listes déroulantes sont maintenant dans base.html */

.image-preview-container,
.video-preview-container {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-top: 1rem;
}

.preview-item {
    position: relative;
    width: 100px;
    height: 100px;
    border-radius: 10px;
    overflow: hidden;
}

.preview-item img,
.preview-item video {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.preview-item .remove-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    background: rgba(220, 53, 69, 0.9);
    color: white;
    border: none;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 2rem;
}

.btn-submit,
.btn-cancel {
    padding: 1rem 2rem;
    border: none;
    border-radius: 10px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-submit {
    background: var(--primary-color);
    color: white;
}

.btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3);
}

.btn-cancel {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-cancel:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

@media (max-width: 768px) {
    .main-container {
        padding: 1rem;
    }
    
    .content-card {
        padding: 2rem;
    }
    
    .price-input-group {
        flex-direction: column;
    }
    
    .form-actions {
        flex-direction: column;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Gestion du champ jeu personnalisé
    const gameSelect = document.getElementById('game');
    const customGameGroup = document.getElementById('custom-game-group');
    const customGameInput = document.getElementById('custom_game_name');
    
    gameSelect.addEventListener('change', function() {
        if (this.value === 'other') {
            customGameGroup.style.display = 'block';
            customGameInput.required = true;
        } else {
            customGameGroup.style.display = 'none';
            customGameInput.required = false;
            customGameInput.value = '';
        }
    });
    
    // Gestion de la bannière
    const bannerInput = document.getElementById('banner');
    const bannerPreview = document.getElementById('banner-preview');
    
    bannerInput.addEventListener('change', function(e) {
        bannerPreview.innerHTML = '';
        const file = e.target.files[0];
        
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.className = 'banner-preview';
                img.alt = 'Bannière preview';
                bannerPreview.appendChild(img);
            };
            reader.readAsDataURL(file);
        }
    });
    
    // Gestion des images
    const imageInput = document.getElementById('images');
    const imagePreview = document.getElementById('image-preview');
    
    imageInput.addEventListener('change', function(e) {
        imagePreview.innerHTML = '';
        const files = Array.from(e.target.files);
        
        files.forEach((file, index) => {
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'preview-item';
                    previewItem.innerHTML = `
                        <img src="${e.target.result}" alt="Preview">
                        <button type="button" class="remove-btn" onclick="removeFile(${index})">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    imagePreview.appendChild(previewItem);
                };
                reader.readAsDataURL(file);
            }
        });
    });
    
    // Gestion de la vidéo
    const videoInput = document.getElementById('video');
    const videoPreview = document.getElementById('video-preview');
    
    videoInput.addEventListener('change', function(e) {
        videoPreview.innerHTML = '';
        const file = e.target.files[0];
        
        if (file && file.type.startsWith('video/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                previewItem.style.width = '200px';
                previewItem.style.height = '150px';
                previewItem.innerHTML = `
                    <video src="${e.target.result}" controls></video>
                    <button type="button" class="remove-btn" onclick="removeVideo()">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                videoPreview.appendChild(previewItem);
            };
            reader.readAsDataURL(file);
        }
    });
});

function removeFile(index) {
    const input = document.getElementById('images');
    const dt = new DataTransfer();
    const files = Array.from(input.files);
    
    files.splice(index, 1);
    files.forEach(file => dt.items.add(file));
    input.files = dt.files;
    
    // Recharger les previews
    input.dispatchEvent(new Event('change'));
}

function removeVideo() {
    const input = document.getElementById('video');
    input.value = '';
    document.getElementById('video-preview').innerHTML = '';
}
</script>

{% endblock %} 